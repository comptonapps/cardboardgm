{% extends 'base.html' %}

{% block content %}
<div class="card-detail-banner">
    <div class="banner-info">
        <h1>{{card.to_string()}}</h1>
        <h3>OWNER: <a href="/users/{{card.owner_id}}">{{card.user.username}}</a></h3>
        <div class="button-box">
            {% if card.owner_id == g.user.id %}
            <form action="/cards/{{card.id}}/edit">
                <button class='banner-btn blue'>Edit Card</button>
            </form>
            {% else %}
            <form action="/cards/{{card.id}}/request">
                <button class='banner-btn blue'>Request Trade</button>
            </form>
            {% endif %}
            <form>
                <button data-search="{{card.to_string()}}" id="search-btn" class="banner-btn green">Search Ebay</button>
            </form>
        </div>
        
    </div>
    <div class="banner-card-container">
        <img src="{% if card.img_url %}
                  {{card.full_img_url()}}
                  {% else %}
                  /static/images/default.jpg
                  {% endif %}" alt="">
        {% if card.img_url %}
        <button id="detail-btn" class="banner-btn green" data-url="{{card.full_img_url()}}"">View Large Image</button>
        {% endif %}
    </div>
    
    {% if card.user.id == g.user.id %}
    
    
    {% endif %}
</div>

<!-- <script src="/static/scripts/alert.js"></script> -->
<script>
    const searchBtn = document.querySelector('#search-btn');
    const detailBtn = document.querySelector('#detail-btn');
    const body = document.querySelector('body');
    searchBtn.addEventListener('click', async function(e) {
        e.preventDefault();
        const modal = new ModalWindow().modalWindow;
        body.append(modal);
        const resultsContainer = document.createElement('div')
        resultsContainer.classList.add('results-container');
        modal.append(resultsContainer);
        let res = await axios.get('/api/ebay', { params : {'item' : searchBtn.dataset.search }})
        for (item of res.data) {
            let cell = new EbayCell(item).cell;
            resultsContainer.append(cell);
        }
    })
    detailBtn.addEventListener('click', function(){
        const modal = new ModalWindow().modalWindow;
        body.append(modal);
        const detailedImage = document.createElement('img');
        detailedImage.classList.add('detail-img')
        detailedImage.setAttribute('src', detailBtn.dataset.url);
        modal.append(detailedImage);
    })


</script>
{% endblock %}