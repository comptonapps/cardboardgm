{% extends 'base.html' %}

{% block content %}
<div class="title-search-banner">
<h1>Search Cards</h1>
<form action="/api/cards" class='search-form'>
    <div class="search-group">
        <input type="text" id="search-input">
        <button id="search-btn" class="search-btn">Search</button>
    </div>
</form>
</div>
<div class="collection-container" id="cc">
{% if cards|length > 0 %}
<h2 id="result-title">Showing All Cards</h2>
<div class="cells-container">
{% for card in cards %}
<a href="/cards/{{card.id}}">
    <div class="collection-cell">
        <div class="cell-image-container">
            <img src=
            {% if card.img_url %}
            "{{card.thumb_url()}}"
            {% else %}
            "/static/images/default.jpg"
            {% endif %}
             alt="">
        </div>
        <p class="cell-title">{{card.to_string()}}</p>
    </div>
</a>
{% endfor %}
</div>
</div>
{% endif %}
<script>
    const cellsContainer = document.querySelector('.cells-container')
    const searchBtn = document.querySelector('.search-btn');
    searchBtn.addEventListener('click', async function(e) {
        e.preventDefault();
        let query = document.querySelector("#search-input").value;
        let tokens;
        if (query) {
            tokens = document.querySelector("#search-input").value.split(" ");
        }
        
        let res = await axios.get('/api/cards', { params : { 'tokens' : JSON.stringify(tokens) } })

        if (res.data.results.length > 0) {
            cellsContainer.innerHTML = "";
            for (card of res.data.results) {
                console.log(card)
                let cell = new Cell(card, true);
                cellsContainer.append(cell.cell);
            }
        } 
        else {
            cellsContainer.innerHTML = ""
            cellsContainer.innerText = "No results found"
            
        }
    });
</script>

{% endblock %}