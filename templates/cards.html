{% extends 'base.html' %}

{% block content %}
<div class="two-item-banner">
    <h1>CARDS</h1>
    <form action="">
        <div class="form-group">
            <input type="text" class="search-field">
            <button class="search-btn">Search</button>
        </div>
    </form>
</div>
<!-- <div class="collection-container" id="cc"> -->
{% if cards|length > 0 %}
<h2 id="result-title">Showing All Cards</h2>
<div class="cells-container">
{% for card in cards %}
<a href="/cards/{{card.id}}">
    <div class="collection-cell">
        <div class="cell-image-container">
            <img src=
            {% if card.img_url %}
            "{{card.thumb_url()}}"
            {% else %}
            "/static/images/default.jpg"
            {% endif %}
             alt="">
        </div>
        <p class="cell-title">{{card.to_string()}}</p>
    </div>
</a>
{% endfor %}
</div>
<!-- </div> -->
{% endif %}
<script>
    const cellsContainer = document.querySelector('.cells-container')
    const searchBtn = document.querySelector('.search-btn');
    const resultTitle = document.querySelector('#result-title')
    searchBtn.addEventListener('click', async function(e) {
        e.preventDefault();
        let query = document.querySelector(".search-field").value;
        let tokens;
        if (query) {
            tokens = query.split(" ");
            resultTitle.innerText = `Showing results for ${query}:`
        }
        
        let res = await axios.get('/api/cards', { params : { 'tokens' : JSON.stringify(tokens) } })

        if (res.data.results.length > 0) {
            cellsContainer.innerHTML = "";
            for (card of res.data.results) {
                console.log(card)
                let cell = new Cell(card, true);
                cellsContainer.append(cell.cell);
            }
        } 
        else {
            cellsContainer.innerHTML = ""
            cellsContainer.innerText = "No results found"
            
        }
    });
</script>

{% endblock %}